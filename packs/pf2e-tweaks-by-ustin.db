{"_id":"nUOk5hpgmi1keCMm","name":"Award XP","type":"script","author":"2yxk0COm8RHyIhD8","img":"icons/svg/upgrade.svg","scope":"global","command":"(function ()\n{\n  function award_xp_pf2(type, amount){\n      // set of players to distribute. \n      let actors = game.actors.contents.filter(e => e.data.type ==='character' && e.hasPlayerOwner);\n      //now deciding XP amount based on encounter type\n      let xp_amount = amount; \n      if (type == \"trivial\") xp_amount = 40;\n      if (type == \"low\") xp_amount = 60;\n      if (type == \"moderate\") xp_amount = 80;\n      if (type == \"severe\") xp_amount = 120;\n      if (type == \"extreme\") xp_amount = 160;\n      if (type == \"minor\") xp_amount = 10;\n      if (type == \"moderate_acc\") xp_amount = 30;\n      if (type == \"major\") xp_amount = 80;\n\n      if(actors.length > 0 && Number.isInteger(xp_amount)){\n          let msg = `\n              <b> ${xp_amount} XP awarded to party! </b> \n              <br> Recipients: \n              `;\n          actors.forEach(actor => \n          {\n              msg += `${actor.name}, `;\n              actor.update({\"data.details.xp.value\": actor.data.data.details.xp.value + xp_amount});\n          });\n      msg = msg.substring(0, msg.length-2);\n      msg += '.';\n      let chatMessageData = {\n        user: game.user.id,\n        speaker: ChatMessage.getSpeaker(),\n        content: msg,\n        type: CONST.CHAT_MESSAGE_TYPES.OTHER\n      };\n      ChatMessage.create(chatMessageData);\n      }\n\n  }\n\n  new Dialog({\n    title: \"Award Party XP\",\n    content: `\n     <b>Select encounter difficulty or enter custom amount.</b>\n     <form>\n      <div class=\"form-group\">\n       <label>Award for</label>\n       <select id=\"award-type\">\n        <option value=\"custom\">Custom</option>\n        <option value=\"trivial\">Trivial encounter (40 exp)</option>\n        <option value=\"low\">Low encounter (60 exp)</option>\n        <option value=\"moderate\">Moderate encounter (80 exp)</option>\n        <option value=\"severe\">Severe encounter (120 exp)</option>\n        <option value=\"extreme\">Extreme encounter (160 exp)</option>\n        <option value=\"minor\">Minor accomplishment (10 exp)</option>\n        <option value=\"moderate_acc\">Moderate accomplishment (30 exp)</option>\n        <option value=\"major\">Major accomplishment (80 exp)</option>\n       </select>\n      </div>\n      <div class=\"form-group\">\n       <label>Amount</label>\n       <input type=\"text\" inputmode=\"numeric\" pattern=\"\\d*\" id=\"custom-xp-amount\">\n      </div>\n     </form>\n     `,\n    buttons: {\n      one: {\n        icon: '<i class=\"fas fa-check\"></i>',\n        label: \"Confirm\",\n        callback: (html) =>\n        {\n          let type = html.find('[id=award-type]')[0].value;\n          let amount = parseInt(html.find('[id=custom-xp-amount]')[0].value);\n          award_xp_pf2(type, amount);\n        }\n      },\n      two: {\n        icon: '<i class=\"fas fa-times\"></i>',\n        label: \"Cancel\",\n      }\n    },\n    default: \"Cancel\"\n  }).render(true);\n})();","folder":null,"sort":0,"permission":{"default":0,"2yxk0COm8RHyIhD8":3},"flags":{"core":{"sourceId":"Macro.81hKiTW3ewgpcUnE"}}}
